name: Update No Commits Counter

on:
  schedule:
    - cron: '0 0 * * *'  # Запуск каждый день в полночь
  workflow_dispatch:      # Позволяет запускать вручную
  push:
    branches: [ main ]    # Обновляет при push в main

jobs:
  update-counter:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Check last commit date
        id: last_commit
        run: |
          LAST_COMMIT=$(git log -1 --format=%ct)
          CURRENT_TIME=$(date +%s)
          DAYS_DIFF=$(( ($CURRENT_TIME - $LAST_COMMIT) / 86400 ))
          echo "DAYS_WITHOUT_COMMITS=$DAYS_DIFF" >> $GITHUB_ENV
          
      - name: Update README
        run: |
          sed -i "s/Days_without_commits-[0-9]*-red/Days_without_commits-${{ env.DAYS_WITHOUT_COMMITS }}-red/" README.md
          
      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git diff --quiet && git diff --staged --quiet || git commit -m "Update days without commits counter"
          git push
